/*! plug-1.0.0.js 2018-02-03 10:11:30 */

!function(t){function e(e){this.config=t.extend({id:"#select",class:"",width:190,height:36,showInput:!0,multiple:null,inputmultiple:null,searchinput:null,defaulted:"请选择",stringClass:null,dataUrl:null,inputid:null},e),this.state={searchinput:null,showbox:null,selectBox:null,ulbox:null,inputBox:null,div:null,searchBox:null,open:!1,selectedValue:-1,originalData:[],filteredData:[],arrmultiple:[],arr:[],valueReturn:[]}}t.fn.Select=function(s,a){var i=new e(s,a);return i.init(t(this))||i},e.prototype={init:function(t){this.readSelect(t),this.createSelect(t)},createSelect:function(e){var s=this.config.width,a=this.config.height,i=this.config.defaulted,l=this.config.inputid;document.onselectstart=function(){return!1},this.state.showbox=t("<div id='"+l+"'></div>").addClass("selects"),null!==this.config.searchinput&&(this.state.searchinput=t("<input type='text' value='"+i+"'>").addClass("searchinput").on("click",{self:this},this.selectBoxClicked).css({width:s+"px",height:a+"px"}),this.state.selectBox=t("<div></div>").addClass("selectbox").on("click",{self:this},this.selectBoxClicked).css({width:s+"px",height:a+"px"}),this.state.showbox.append(this.state.searchinput),this.state.div=t('<div class="closediv"></div>'),this.state.showbox.append(this.state.div),this.state.dropdownBox=t("<div style='margin-top:0;'></div>").addClass("dropdownBox").hide(),this.state.dropdown=t("<div></div>").addClass("dropdown").css({width:s+"px"}),this.config.showInput&&this.createSearch(this.state.dropdown),this.state.ulbox=t("<ul></ul>").addClass("itemcontainer"),this.state.dropdown.append(this.state.ulbox),this.createItems()),null==this.config.searchinput&&(this.state.selectBox=t("<div></div>").addClass("selectbox").on("click",{self:this},this.selectBoxClicked).css({width:s+"px",height:a+"px"}),this.state.showbox.append(this.state.selectBox),this.state.dropdownBox=t("<div></div>").addClass("dropdownBox").hide(),this.state.dropdown=t("<div></div>").addClass("dropdown").css({width:s+"px"}),this.config.showInput&&this.createSearch(this.state.dropdown),this.state.ulbox=t("<ul></ul>").addClass("itemcontainer"),this.state.dropdown.append(this.state.ulbox),this.createItems()),this.state.dropdownBox.append(this.state.dropdown),this.state.showbox.append(this.state.dropdownBox),e.hide().after(this.state.showbox),this.state.$el=e,t(document).on("click",{self:this},this.documentClicked),t(".searchinput,.closediv").mouseenter(function(){t(".closediv").css("display","block")}),t(".searchinput,.closediv").mouseleave(function(){t(".closediv").css("display","none")}),t(".closediv").on("click",function(e){e.stopPropagation(),e.cancelBubble=!0,t(".itemcontainer .item").removeClass("selected")})},createSearch:function(e){var s=this.config.width;this.state.inputBox=t("<div></div>").addClass("searchcontainer").css({width:s+"px"}),this.state.searchBox=t("<input type='text'>").addClass("searchbox").on("click",function(t){t.stopPropagation()}).on("keyup",{self:this},this.searchKeyPress),this.state.inputBox.append(t("<span class='searchicon'></span>")),this.state.inputBox.append(this.state.searchBox),this.state.dropdownBox.append(this.state.inputBox)},createItems:function(e){var s,a;for(this.state.ulbox.empty(),s=0;s<this.state.filteredData.length;s++){a=this.state.filteredData[s];var i=t("<input name='checkbox' type='checkbox'>").val(a.text).attr("value1",a.val).addClass("checkboxs"),l=t("<li></li>").text(a.text).addClass("item").attr("value1",a.val);a.val==this.state.selectedValue&&(null!==this.config.multiple&&l.removeClass("selected"),this.config.multiple,null!=this.config.searchinput&&l.addClass("selected"),null==this.config.searchinput&&this.state.selectBox.html(a.text)),a.selected&&(this.state.selectBox.html(a.text),l.addClass("selected")),null!==this.config.inputmultiple&&(l.removeClass("selected"),l.prepend(i),i.on("click",{self:this},this.searcheckbox),l.on("click",{self:this},this.searchinputli),this.state.ulbox.on("click",function(t){t.stopPropagation(),t.cancelBubble=!0})),null==this.config.inputmultiple&&l.on("click",{self:this},this.selectLiClicked),this.state.ulbox.append(l)}var n=this.state.searchinput,c=this.config.stringClass;if(null!=this.config.inputmultiple){var o=t(n).val().split(","),d=t(c).text().replace(/(^\s*)|(\s*$)/g,"");this.state.ulbox.find("li").filter(function(e,s){(o.indexOf(t(s).text())>=0||d.indexOf(t(s).text())>=0)&&t(s).addClass("selected ").find("input").attr("checked","true"),d.indexOf(t(s).text())>=0&&(n.val(d),t(s).addClass("selected ").find("input").attr("checked","true"))})}},readSelect:function(e){var s=this;e.find("option").each(function(){var e=t(this);s.state.originalData.push({val:e.val(),text:e.text(),selected:e.is(":selected")})}),this.state.filteredData=this.state.originalData,this.state.selectedValue=e.find("option").val()},documentClicked:function(t){var e=t.data.self;e.state.open&&e.selectBoxClicked(t)},searchKeyPress:function(e){var s=e.data.self,a=t(e.currentTarget).val();0===a.length?s.state.filteredData=s.state.originalData:s.state.filteredData=s.state.originalData.filter(function(t){return t.text.toLowerCase().indexOf(a)>=0}),s.createItems()},selectBoxClicked:function(e){var s=e.data.self,a=s.config.defaulted;if(!s.state.dropdownBox.is(":animated")){if(s.state.open)return s.state.open=!1,null!==s.config.searchinput&&(s.state.searchinput.removeClass("open"),0==s.state.searchinput.val().length&&s.state.searchinput.val(a)),null==s.config.searchinput&&s.state.selectBox.removeClass("open"),void s.state.dropdownBox.slideUp(1);null!==s.config.dataUrl&&t.ajax({url:s.config.dataUrl,dataType:"json",type:"GET"}).success(function(t){s.ajaxLoadSuccess(s,t)}).error(function(t){alert("数据请求错误!!!")}),s.state.open=!0,null!==s.config.searchinput&&(s.state.searchinput.addClass("open"),s.state.searchinput.val()==a&&s.state.searchinput.val("")),null==s.config.searchinput&&s.state.selectBox.addClass("open"),s.state.dropdownBox.slideDown(1)}},ajaxLoadSuccess:function(t,e){"object"==typeof e?(e.forEach(function(e){e.selected&&(t.state.selectedValue=e.val)}),t.state.originalData=e,t.state.filteredData=e,null!==this.state.inputBox&&this.state.inputBox.show(),t.createItems()):alert("数据格式不对")},selectLiClicked:function(e){t(this);var s,a=e.data.self,i=t(e.currentTarget),l=[];i.removeClass("selected");var n=i.attr("value1");a.state.dropdown.find("li").each(function(e){if(a.state.arrmultiple.push({val:n,text:i.text()}),null!==a.config.multiple||null!==a.config.inputmultiple){for(e=0;e<a.state.arrmultiple.length;e++)-1==a.state.arr.indexOf(a.state.arrmultiple[e])&&(a.state.arr.length=0,a.state.arr.push(a.state.arrmultiple[e]));return a.state.arr.forEach(function(e){var n=t("<div></div>").addClass("spandiv"),c=t("<input name='value' type='hidden'>").addClass("spandiv").val(e.val);s=t("<span></span>").text(e.text).attr("span-value",e.val).addClass("items").append(n).append(c),n=a.config.class,a.state.arr.length,t(n).find("span").each(function(){l.push(t(this).text())});for(var o=0;o<l.length;o++)if(l[o]==i.text())return!1;null!==a.config.inputmultiple&&a.state.searchinput.append(s),t(n).append(s),t(n).find(".spandiv").on("click",function(){t(this).parent().remove(),t(this).parent().text()==i.text()&&i.removeClass("selected")})}),!1}t(this).removeClass("selected")}),i.addClass("selected");var c=i.text();a.state.selectedValue=t(this).attr("value");var o=a.config.id;null!==a.config.searchinput&&(a.state.searchinput.val(i.text()),a.state.selectedValue=i.attr("value1"),t(o).attr("text",function(){return c})),null==a.config.searchinput&&(a.state.selectBox.html(i.text()),a.state.selectedValue=i.attr("value1"),t(o).attr("select-value",function(){return c}));n=i.attr("value1");t(o).val(n)},searcheckbox:function(e){var s=t(this),a=e.data.self,i="";null!==a.config.inputmultiple&&(e.stopPropagation(),e.cancelBubble=!0),a.state.ulbox.find("input:checked").each(function(e){0==e?i=t(this).val():i+=","+t(this).val()}),"true"==s.is(":checked").toString()&&s.parent().addClass("selected"),"false"==s.is(":checked").toString()&&s.parent().removeClass("selected");var l=a.config.stringClass;t(l).text(i).addClass("default"),a.state.searchinput.val(i)},searchinputli:function(e){var s=t(this),a=e.data.self,i="";null!==a.config.inputmultiple&&(e.stopPropagation(),e.cancelBubble=!0);var l=t(this).find(":checkbox");l.prop("checked",!l.prop("checked")),a.state.ulbox.find("input:checked").each(function(e){0==e?i=t(this).val():i+=","+t(this).val()}),"true"==t(".checkbox").is(":checked").toString()&&s.addClass("selected"),"false"==t(".checkbox").eq(s.index()).is(":checked").toString()&&s.removeClass("selected");var n=a.config.stringClass;t(n).text(i).addClass("default"),a.state.searchinput.val(i)},valueselected:function(){var e,s=[],a="";this.state.ulbox.find("input:checked").each(function(e){0==e?a=t(this).attr("value1"):a+=","+t(this).attr("value1")}),e=a.split(",");for(var i=0;i<e.length;i++)-1==this.state.valueReturn.indexOf(e[i])&&(this.state.valueReturn.length=0,this.state.valueReturn.push({val:e[i]}),s.push({val:this.state.valueReturn[0].val}));return s}}}(jQuery);