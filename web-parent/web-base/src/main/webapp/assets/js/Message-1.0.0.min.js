/*! Framework-web-1.0.0.js 2018-02-03 10:39:31 北京轩慧国信科技有限公司*/

function Message(n){return this.config={sendData:null,socketSite:"",socketUrl:"",socket:null,timerid:null,events:[]},$.extend(this.config,n),this.init(),this}Message.prototype={init:function(){var n=this,o=n.config.socket;n.initUrl(),(o="WebSocket"in window?new WebSocket(n.config.socketUrl):"MozWebSocket"in window?new MozWebSocket(n.config.socketUrl):new SockJS(n.config.socketUrl)).onopen=function(){null!=n.config.sendData&&(o.send(n.config.sendData),console.log("信息发送中")),console.log("连接成功")},o.onmessage=function(o){var e=o.data,t=(e=JSON.parse(e)).event;e?n.triggerEvent(t,e):console.log("数据不存在")},o.onclose=function(){console.log("连接关闭");var o=n.config.timerid;null!=o&&window.clearInterval(o),n.againLink()},o.onerror=function(n){console.log("连接错误...")}},initUrl:function(){var n=this.config.socketSite;n="http:"==window.location.protocol?"ws://"+n:"wss://"+n,this.config.socketUrl=n},againLink:function(){var n=this,o=n.config.timerid=window.setInterval(function(){(console.log("正在重新连接..."),null!=n.config.socket)?1==n.config.socket.readyState&&(window.clearInterval(o),console.log("重新连接成功")):n.init()},2e3)},addEvent:function(n,o){this.config.events.push({eventId:n,callBack:o})},triggerEvent:function(n,o){for(var e in this.config.events){var t=this.config.events[e];t.eventId===n&&t.callBack.apply(this,[o])}}},function(n){n.UDP?n.UDP.Message=Message:n.UDP={Message:Message}}(window);